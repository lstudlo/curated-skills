---
import type {SkillEntry} from "../lib/skills";
import {buildSkillHref, formatBytes} from "../lib/skills";

interface Props {
	skill: SkillEntry;
}

const {skill} = Astro.props as Props;

const previewFiles = skill.files.slice(0, 3);
const primaryDownload = `/download-skill/${encodeURIComponent(skill.slug)}`;
---

<article
        class="flex h-full flex-col justify-between rounded-4xl border border-zinc-200/80 bg-white/75 p-5 backdrop-blur transition hover:-translate-y-0.5 hover:border-zinc-900 dark:border-zinc-800 dark:bg-zinc-950/70 dark:hover:border-zinc-100">
    <div>
        <div class="flex items-start justify-between gap-3">
            <div class="min-w-0">
                <p class="truncate text-[11px] tracking-[0.16em] text-zinc-500 uppercase">{skill.directoryName}</p>
                <h3 class="mt-1 line-clamp-2 font-serif text-2xl leading-tight tracking-tight">
                    <a href={buildSkillHref(skill.slug)} class="hover:underline">
							  {skill.title}
                    </a>
                </h3>
            </div>

        </div>

        <p class="mt-3 line-clamp-3 text-sm leading-6 text-zinc-600 dark:text-zinc-300">
			  {skill.description}
        </p>

        <dl class="mt-5 grid grid-cols-3 gap-2 text-xs">
            <div class="rounded-xl border border-zinc-200/80 p-2 dark:border-zinc-800">
                <dt class="text-zinc-500">Files</dt>
                <dd class="mt-1 font-mono text-zinc-900 dark:text-zinc-100">{skill.fileCount}</dd>
            </div>
            <div class="rounded-xl border border-zinc-200/80 p-2 dark:border-zinc-800">
                <dt class="text-zinc-500">Dirs</dt>
                <dd class="mt-1 font-mono text-zinc-900 dark:text-zinc-100">{skill.directoryCount}</dd>
            </div>
            <div class="rounded-xl border border-zinc-200/80 p-2 dark:border-zinc-800">
                <dt class="text-zinc-500">Size</dt>
                <dd class="mt-1 font-mono text-zinc-900 dark:text-zinc-100">{formatBytes(skill.totalBytes)}</dd>
            </div>
        </dl>

        <div class="mt-5 rounded-xl border border-zinc-200/80 bg-zinc-50/60 p-3 dark:border-zinc-800 dark:bg-zinc-900/50">
            <div class="flex flex-row w-full justify-between"><p class="text-[11px] tracking-widest text-zinc-500 uppercase">Sample Files</p>
                <span class="shrink-0 rounded-full border border-zinc-300/80 px-2 py-0.5 font-mono text-[11px] dark:border-zinc-700">
                  {skill.fileCount}
                </span>
            </div>
            <ul class="mt-2 space-y-1 font-mono text-xs text-zinc-700 dark:text-zinc-300">
					{previewFiles.map((file) => (
                       <li class="truncate">{file.relativePath}</li>
					))}
            </ul>
        </div>
    </div>

    <div class="mt-5 flex items-center gap-2">
        <a
                href={buildSkillHref(skill.slug)}
                class="inline-flex rounded-full border border-[var(--accent)] bg-[var(--accent)] px-3 py-1.5 text-xs tracking-[0.14em] text-white uppercase hover:opacity-90 dark:text-zinc-950"
        >
            Open
        </a>
		 {primaryDownload && (
               <a
                       href={primaryDownload}
                       download
                       class="inline-flex rounded-full border border-zinc-300/80 px-3 py-1.5 text-xs tracking-[0.14em] uppercase hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-900"
               >
                   ZIP
               </a>
		 )}
    </div>
</article>
