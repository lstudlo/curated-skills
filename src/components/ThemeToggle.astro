<button
  type="button"
  data-theme-toggle
  class="inline-flex items-center gap-2 rounded-full border border-zinc-300/80 bg-white/70 px-3 py-1.5 text-xs tracking-[0.16em] uppercase backdrop-blur transition hover:bg-zinc-50 dark:border-zinc-700 dark:bg-black/70 dark:hover:bg-zinc-900"
  aria-label="Toggle color theme"
>
  <span class="size-1.5 rounded-full bg-zinc-900 dark:bg-zinc-100"></span>
  <span data-theme-toggle-label>Theme</span>
</button>

<script is:inline>
  (() => {
    const STORAGE_KEY = 'curated-skills-theme';

    const getResolvedTheme = () => {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved === 'light' || saved === 'dark') return saved;
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };

    const applyTheme = (theme) => {
      document.documentElement.classList.toggle('dark', theme === 'dark');
      document.documentElement.dataset.theme = theme;
      const label = document.querySelector('[data-theme-toggle-label]');
      if (label) {
        label.textContent = theme === 'dark' ? 'Dark' : 'Light';
      }
    };

    const bind = () => {
      const button = document.querySelector('[data-theme-toggle]');
      if (!button || button.dataset.bound === 'true') return;

      button.dataset.bound = 'true';
      applyTheme(getResolvedTheme());

      button.addEventListener('click', () => {
        const nextTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
        localStorage.setItem(STORAGE_KEY, nextTheme);
        applyTheme(nextTheme);
      });
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', bind, { once: true });
    } else {
      bind();
    }

    document.addEventListener('astro:page-load', bind);
  })();
</script>
